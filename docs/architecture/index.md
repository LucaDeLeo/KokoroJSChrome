# KokoroJS Chrome Extension - Brownfield Enhancement Architecture

## Table of Contents

- [KokoroJS Chrome Extension - Brownfield Enhancement Architecture](#table-of-contents)
  - [Section 1: Introduction](./section-1-introduction.md)
    - [Existing Project Analysis](./section-1-introduction.md#existing-project-analysis)
    - [Change Log](./section-1-introduction.md#change-log)
  - [Section 1.5: Architectural Philosophy & Modular Redesign](./section-15-architectural-philosophy-modular-redesign.md)
    - [Core Philosophy: Primitives vs Structure](./section-15-architectural-philosophy-modular-redesign.md#core-philosophy-primitives-vs-structure)
      - [The Primitive: TTS Request/Response Events](./section-15-architectural-philosophy-modular-redesign.md#the-primitive-tts-requestresponse-events)
      - [The Structure: Pipeline Architecture](./section-15-architectural-philosophy-modular-redesign.md#the-structure-pipeline-architecture)
    - [Modular Design Principles](./section-15-architectural-philosophy-modular-redesign.md#modular-design-principles)
      - [1. Minimal Core, Maximum Plugins](./section-15-architectural-philosophy-modular-redesign.md#1-minimal-core-maximum-plugins)
      - [2. Plugin Architecture](./section-15-architectural-philosophy-modular-redesign.md#2-plugin-architecture)
      - [3. Comprehensive Platform Abstraction Layer (PAL)](./section-15-architectural-philosophy-modular-redesign.md#3-comprehensive-platform-abstraction-layer-pal)
      - [4. Stable, Future-Proof APIs](./section-15-architectural-philosophy-modular-redesign.md#4-stable-future-proof-apis)
    - [Module Organization for Single Developer](./section-15-architectural-philosophy-modular-redesign.md#module-organization-for-single-developer)
    - [Performance Monitoring Strategy](./section-15-architectural-philosophy-modular-redesign.md#performance-monitoring-strategy)
    - [Essential Tooling Ecosystem](./section-15-architectural-philosophy-modular-redesign.md#essential-tooling-ecosystem)
    - [Risk Profile & Mitigation](./section-15-architectural-philosophy-modular-redesign.md#risk-profile-mitigation)
  - [Section 2: Enhancement Scope and Integration Strategy](./section-2-enhancement-scope-and-integration-strategy.md)
    - [Enhancement Overview](./section-2-enhancement-scope-and-integration-strategy.md#enhancement-overview)
    - [Integration Approach](./section-2-enhancement-scope-and-integration-strategy.md#integration-approach)
    - [Compatibility Requirements](./section-2-enhancement-scope-and-integration-strategy.md#compatibility-requirements)
  - [Section 3: Tech Stack (Risk-Aware)](./section-3-tech-stack-risk-aware.md)
    - [Existing Technology Stack](./section-3-tech-stack-risk-aware.md#existing-technology-stack)
    - [New Technology Additions (Risk-Mitigated)](./section-3-tech-stack-risk-aware.md#new-technology-additions-risk-mitigated)
    - [Risk-Driven Technology Decisions](./section-3-tech-stack-risk-aware.md#risk-driven-technology-decisions)
  - [Section 4: Data Models and Schema Changes](./section-4-data-models-and-schema-changes.md)
    - [New Data Models](./section-4-data-models-and-schema-changes.md#new-data-models)
      - [TTSSession Model](./section-4-data-models-and-schema-changes.md#ttssession-model)
      - [TextCache Model](./section-4-data-models-and-schema-changes.md#textcache-model)
      - [UserPreferences Model](./section-4-data-models-and-schema-changes.md#userpreferences-model)
      - [ModelMetadata Model](./section-4-data-models-and-schema-changes.md#modelmetadata-model)
    - [Schema Integration Strategy](./section-4-data-models-and-schema-changes.md#schema-integration-strategy)
    - [Storage Architecture](./section-4-data-models-and-schema-changes.md#storage-architecture)
  - [Section 5: Component Architecture (Redesigned as Plugins)](./section-5-component-architecture-redesigned-as-plugins.md)
    - [Core Components (Minimal)](./section-5-component-architecture-redesigned-as-plugins.md#core-components-minimal)
      - [TTSCore Component](./section-5-component-architecture-redesigned-as-plugins.md#ttscore-component)
    - [Plugin Components](./section-5-component-architecture-redesigned-as-plugins.md#plugin-components)
      - [ContentExtractor Plugin](./section-5-component-architecture-redesigned-as-plugins.md#contentextractor-plugin)
      - [KokoroEngine Plugin](./section-5-component-architecture-redesigned-as-plugins.md#kokoroengine-plugin)
      - [OffscreenAudio Plugin](./section-5-component-architecture-redesigned-as-plugins.md#offscreenaudio-plugin)
      - [UIRenderer Plugin](./section-5-component-architecture-redesigned-as-plugins.md#uirenderer-plugin)
      - [QueueManager Plugin](./section-5-component-architecture-redesigned-as-plugins.md#queuemanager-plugin)
      - [ErrorHandler Plugin](./section-5-component-architecture-redesigned-as-plugins.md#errorhandler-plugin)
    - [Component Interaction Diagram](./section-5-component-architecture-redesigned-as-plugins.md#component-interaction-diagram)
  - [Section 6: API Design and Integration](./section-6-api-design-and-integration.md)
    - [API Integration Strategy](./section-6-api-design-and-integration.md#api-integration-strategy)
    - [Chrome Extension API Endpoints](./section-6-api-design-and-integration.md#chrome-extension-api-endpoints)
      - [chrome.runtime Messaging API](./section-6-api-design-and-integration.md#chromeruntime-messaging-api)
      - [chrome.offscreen API](./section-6-api-design-and-integration.md#chromeoffscreen-api)
    - [External API Integration](./section-6-api-design-and-integration.md#external-api-integration)
      - [Model CDN API](./section-6-api-design-and-integration.md#model-cdn-api)
  - [Section 7: Source Tree (Plugin-Based Architecture)](./section-7-source-tree-plugin-based-architecture.md)
    - [Existing Project Structure (Preserved Core Only)](./section-7-source-tree-plugin-based-architecture.md#existing-project-structure-preserved-core-only)
    - [New Plugin-Based File Organization](./section-7-source-tree-plugin-based-architecture.md#new-plugin-based-file-organization)
    - [Integration Guidelines](./section-7-source-tree-plugin-based-architecture.md#integration-guidelines)
  - [Section 8: Infrastructure and Deployment Integration](./section-8-infrastructure-and-deployment-integration.md)
    - [Existing Infrastructure](./section-8-infrastructure-and-deployment-integration.md#existing-infrastructure)
    - [Enhancement Deployment Strategy](./section-8-infrastructure-and-deployment-integration.md#enhancement-deployment-strategy)
    - [Rollback Strategy](./section-8-infrastructure-and-deployment-integration.md#rollback-strategy)
    - [Deployment Pipeline](./section-8-infrastructure-and-deployment-integration.md#deployment-pipeline)
    - [Chrome Web Store Deployment Strategy](./section-8-infrastructure-and-deployment-integration.md#chrome-web-store-deployment-strategy)
  - [Section 9: Coding Standards](./section-9-coding-standards.md)
    - [Existing Standards Compliance](./section-9-coding-standards.md#existing-standards-compliance)
    - [Enhancement-Specific Standards](./section-9-coding-standards.md#enhancement-specific-standards)
    - [Critical Integration Rules](./section-9-coding-standards.md#critical-integration-rules)
    - [Code Organization Standards](./section-9-coding-standards.md#code-organization-standards)
  - [Section 10: Testing Strategy](./section-10-testing-strategy.md)
    - [Integration-First Testing Approach](./section-10-testing-strategy.md#integration-first-testing-approach)
    - [Testing Pyramid (Inverted for Chrome Extensions)](./section-10-testing-strategy.md#testing-pyramid-inverted-for-chrome-extensions)
    - [Integration Test Strategy](./section-10-testing-strategy.md#integration-test-strategy)
    - [What to Test](./section-10-testing-strategy.md#what-to-test)
      - [Integration Tests (Priority 1)](./section-10-testing-strategy.md#integration-tests-priority-1)
      - [Integration Tests](./section-10-testing-strategy.md#integration-tests)
      - [Regression Testing](./section-10-testing-strategy.md#regression-testing)
    - [Test Automation](./section-10-testing-strategy.md#test-automation)
  - [Section 11: Security Integration](./section-11-security-integration.md)
    - [Existing Security Measures](./section-11-security-integration.md#existing-security-measures)
    - [Enhancement Security Requirements](./section-11-security-integration.md#enhancement-security-requirements)
    - [Security Testing](./section-11-security-integration.md#security-testing)
    - [Security Architecture](./section-11-security-integration.md#security-architecture)
    - [Content Script Security](./section-11-security-integration.md#content-script-security)
  - [Section 12: Modular Architecture Benefits](./section-12-modular-architecture-benefits.md)
    - [Architectural Improvements from Redesign](./section-12-modular-architecture-benefits.md#architectural-improvements-from-redesign)
      - [Quantifiable Benefits](./section-12-modular-architecture-benefits.md#quantifiable-benefits)
      - [Development Velocity](./section-12-modular-architecture-benefits.md#development-velocity)
      - [Risk Mitigation Matrix](./section-12-modular-architecture-benefits.md#risk-mitigation-matrix)
    - [Ultra-Thorough Validation Results](./section-12-modular-architecture-benefits.md#ultra-thorough-validation-results)
      - [Addressed Gaps from Initial Review:](./section-12-modular-architecture-benefits.md#addressed-gaps-from-initial-review)
  - [Section 13: Next Steps](./section-13-next-steps.md)
    - [Implementation Roadmap (Single Developer)](./section-13-next-steps.md#implementation-roadmap-single-developer)
      - [Phase 1: Foundation (Days 1-3)](./section-13-next-steps.md#phase-1-foundation-days-1-3)
      - [Phase 2: MVP Plugins (Days 4-10)](./section-13-next-steps.md#phase-2-mvp-plugins-days-4-10)
      - [Phase 3: Integration & Testing (Days 11-12)](./section-13-next-steps.md#phase-3-integration-testing-days-11-12)
      - [Phase 4: Enhancement Plugins (Days 13-20)](./section-13-next-steps.md#phase-4-enhancement-plugins-days-13-20)
    - [Story Manager Handoff](./section-13-next-steps.md#story-manager-handoff)
    - [Developer Handoff](./section-13-next-steps.md#developer-handoff)
